<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSig Recovery - Your Keys, Your Control</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' https://cdn.jsdelivr.net; connect-src 'self'; object-src 'none'; base-uri 'none'; form-action 'self'">
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@latest/lib/index.min.js" defer></script>
    <script src="recovery.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
            background: linear-gradient(135deg, #14F195 0%, #9945FF 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 32px;
            background: linear-gradient(135deg, #14F195 0%, #9945FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 40px;
            font-size: 14px;
        }
        
        .proof-section {
            background: rgba(20, 241, 149, 0.1);
            border: 1px solid rgba(20, 241, 149, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .proof-title {
            color: #14F195;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .proof-text {
            color: #ccc;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #14F195 0%, #9945FF 100%);
            border: none;
            border-radius: 12px;
            color: #000;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 20px;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(20, 241, 149, 0.3);
        }
        
        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .wallet-info {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .wallet-info.active {
            display: block;
        }
        
        .info-row {
            margin-bottom: 20px;
        }
        
        .info-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .info-value {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 8px;
            word-break: break-all;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .hidden {
            filter: blur(10px);
            user-select: none;
        }
        
        .export-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .export-button {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .export-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .warning {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid rgba(255, 59, 48, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 20px;
            font-size: 12px;
            color: #ff9999;
        }
        
        .steps {
            margin: 30px 0;
        }
        
        .step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            opacity: 0.5;
            transition: opacity 0.3s;
        }
        
        .step.active {
            opacity: 1;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            font-size: 14px;
        }
        
        .step.active .step-number {
            background: linear-gradient(135deg, #14F195 0%, #9945FF 100%);
            color: #000;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .step-description {
            font-size: 14px;
            color: #888;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üîê</div>
        <h1>WebSig Recovery</h1>
        <p class="subtitle">Prove you own your wallet ‚Ä¢ No backend needed ‚Ä¢ 100% client-side</p>
        
        <div class="proof-section">
            <div class="proof-title">
                <span>‚úÖ</span> What This Proves
            </div>
            <div class="proof-text">
                This page demonstrates that your wallet is derived entirely from YOUR passkey. 
                WebSig has no control over your funds. Even if WebSig disappears, you can 
                always recover your wallet using this tool.
            </div>
        </div>
        
        <div class="proof-section">
            <div class="proof-title">
                <span>üîí</span> How It Works
            </div>
            <div class="proof-text">
                1. Your biometric unlocks your passkey<br>
                2. The passkey derives a unique secret (PRF)<br>
                3. This secret generates your Solana wallet<br>
                4. Everything happens in YOUR browser<br>
                5. No data is sent anywhere
            </div>
        </div>
        
        <!-- Advanced (optional) - hidden by default to keep UX simple -->
        <div class="proof-section" style="margin-top: -10px;">
            <div class="proof-title"><span>‚öôÔ∏è</span> Advanced (optional)</div>
            <details>
                <summary style="cursor:pointer;color:#aaa">Use shared wrap seed (paste JSON)</summary>
                <div class="proof-text" style="margin:12px 0;">
                    If you paired across ecosystems, paste your encrypted wrap here to recover the same shared seed. Otherwise, skip this.
                </div>
                <label class="info-label" for="wrapInput">Encrypted Wrap JSON</label>
                <textarea id="wrapInput" placeholder='{"iv":"...","ciphertext":"...","rpId":"websig.xyz","credIdHash":"..."}' style="width:100%;height:90px;border-radius:8px;border:1px solid rgba(255,255,255,.15);background:rgba(0,0,0,.3);color:#ddd;padding:10px;font-family:monospace;font-size:12px;"></textarea>
            </details>
        </div>

        <button class="button" id="recoverBtn">
            üîì Recover My Wallet
        </button>
        
        <div class="steps">
            <div class="step" id="step1">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">Authenticate with Passkey</div>
                    <div class="step-description">Use your biometric to unlock</div>
                </div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">Derive Wallet Locally</div>
                    <div class="step-description">Generate keys in your browser</div>
                </div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">Access Your Wallet</div>
                    <div class="step-description">View and backup your native WebSig key</div>
                </div>
            </div>
        </div>
        
        <div class="wallet-info" id="walletInfo">
            <div class="info-row">
                <div class="info-label">Account Index</div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button class="export-button" id="decIdx" style="padding: 6px 12px;">‚Üê</button>
                    <input type="number" id="accountIndex" value="0" min="0" style="width: 60px; padding: 6px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white; text-align: center;">
                    <button class="export-button" id="incIdx" style="padding: 6px 12px;">‚Üí</button>
                </div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Your Solana Address</div>
                <div class="info-value" id="address">...</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">Private Key (Uint8Array)</div>
                <div class="info-value hidden" id="privateKey">...</div>
            </div>
            <div class="info-row">
                <div class="info-label">Private Key (Base58)</div>
                <div class="info-value hidden" id="privateKeyB58">...</div>
            </div>
            
            <button class="button" id="revealBtn">
                üëÅ Reveal Private Key
            </button>
            
            <div class="export-buttons">
                <button class="export-button" id="copyKeyBtn">
                    üìã Copy Key
                </button>
                <button class="export-button" id="downloadBackupBtn">
                    üíæ Download Encrypted Backup
                </button>
                <button class="export-button" id="copyB58Btn">
                    üìã Copy Base58
                </button>
                <button class="export-button" id="qrBtn">
                    üì± Generate QR
                </button>
            </div>
            
            <div class="warning">
                ‚ö†Ô∏è <strong>Security Warning:</strong> Never share your private key. Anyone with this key has full control of your wallet. This recovery tool is for emergency use only.
            </div>
        </div>
    </div>
</body>
</html>
